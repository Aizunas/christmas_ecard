<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Christmas E-card</title>
<style>
  * { box-sizing: border-box; margin:0; padding:0; }
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
  }
  .container { position: relative; width:400px; height:400px; }
  img {
    position:absolute;
    left:50%;
    transform: translateX(-50%);
    bottom:-100px;
    width:300px;
    pointer-events:none;
    transition: opacity 0.4s ease;
  }
  .envelope-closed { z-index:5; opacity:1; }
  .envelope-open { z-index:6; opacity:0; }
  .envelope-empty { z-index:5; opacity:0; }
  .letter { 
    position:absolute;
    bottom:269px;
    width:250px; 
    z-index:10;
    opacity:0;
    transform: translateX(-50%) translateY(180px);
    transform-origin: bottom center;
  }
  .opening .envelope-closed { opacity:0; }
  .opening .envelope-open { opacity:1; }
  .opened .envelope-open { opacity:1; } 
  .opened.finished .envelope-open { opacity:0; }
  .opened.finished .envelope-empty { opacity:1; }
  .opened .letter { animation: slideAndUp 1.6s ease-in-out forwards; }
  @keyframes slideAndUp {
    0% { opacity:1; transform: translateX(-50%) translateY(180px); }
    100% { transform: translateX(-50%) translateY(50px) scale(1.05); opacity:1; }
  }
  .closing .letter { animation: slideBackDown 1.3s ease-in-out forwards; }
  @keyframes slideBackDown {
    0% { transform: translateX(-50%) translateY(50px) scale(1.05); opacity:1; }
    100% { transform: translateX(-50%) translateY(180px); opacity:0; }
  }
  .closing.finished .envelope-empty { opacity:0; }
  .closing.finished .envelope-closed { opacity:1; }
  .controls {
    position: absolute;
    bottom:-170px;
    left:50%;
    transform: translateX(-50%);
    z-index:50;
  }
  button {
    padding:14px 36px;
    font-size:16px;
    font-weight:bold;
    border-radius:40px;
    border:2px solid black;
    background:#2b975a;
    color:white;
    cursor:pointer;
    box-shadow:0 5px 15px rgba(0,0,0,0.25);
  }
  button:hover { transform: translateY(-2px); }
  .close-btn { display:none; }
  .opened .open-btn { display:none; }
  .opened .close-btn { display:inline-block; }
</style>
</head>
<body>
<div class="container" id="ecard">
  <!-- Audio element -->
  <audio id="ecard-song" preload="auto">
    <source src="assets/song.m4a" type="audio/mpeg">
    <source src="assets/song.mp3" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>

  <img src="assets/envelope-closed.png" class="envelope-closed">
  <img src="assets/envelope-open.png" class="envelope-open">
  <img src="assets/envelope-empty.png" class="envelope-empty">
  <img src="assets/letter.png" class="letter">

  <div class="controls">
    <button class="open-btn" id="openBtn">OPEN</button>
    <button class="close-btn" id="closeBtn">CLOSE</button>
  </div>
</div>

<script>
const ecard = document.getElementById('ecard');
const song = document.getElementById('ecard-song');
const openBtn = document.getElementById('openBtn');
const closeBtn = document.getElementById('closeBtn');

openBtn.addEventListener('click', () => {
  // Direct user interaction ensures Safari will play
  song.currentTime = 0;
  song.play().catch(e => console.log("Audio blocked:", e));

  ecard.classList.remove('closing','finished');
  ecard.classList.add('opening');

  setTimeout(()=>{
    ecard.classList.remove('opening');
    ecard.classList.add('opened');
  }, 800);

  setTimeout(()=>{
    ecard.classList.add('finished');
  }, 1000);
});

closeBtn.addEventListener('click', () => {
  song.pause();
  song.currentTime = 0;

  ecard.classList.remove('opened','finished');
  ecard.classList.add('closing');

  setTimeout(()=>{
    ecard.classList.add('finished');
  }, 1300);

  setTimeout(()=>{
    ecard.classList.remove('closing','finished');
  }, 1400);
});
</script>
</body>
</html>
